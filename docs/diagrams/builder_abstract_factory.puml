@startuml Clases_Builder_Director_AF
title Diagrama de Clases - Builder + Director + Abstract Factory

package "Builder Pattern" {
  interface VMBuilder {
    +reset()
    +set_name(name)
    +set_region(region)
    +set_cpu_ram_by_tier(tier)
    +set_image_defaults()
    +set_network_defaults()
    +build(): Dict
    +peek(): Dict
  }

  class VMTierDirector {
    +construct(builder: VMBuilder, name, region, tier, profile, ...): Dict
    -_tier_to_compute(tier): (int, int)
  }

  class AWSVMBuilder
  class AzureVMBuilder
  class GCPVMBuilder
  class OnPremVMBuilder
  class OracleVMBuilder

  VMBuilder <|.. AWSVMBuilder
  VMBuilder <|.. AzureVMBuilder
  VMBuilder <|.. GCPVMBuilder
  VMBuilder <|.. OnPremVMBuilder
  VMBuilder <|.. OracleVMBuilder
  VMTierDirector --> VMBuilder : orquesta
}

package "Abstract Factory" {
  interface CloudAbstractFactory {
    +create_virtual_machine(name, config)
  }
  class AWSCloudFactory
  class AzureCloudFactory
  class GCPCloudFactory
  class OracleCloudFactory
  class OnPremiseCloudFactory
  CloudAbstractFactory <|.. AWSCloudFactory
  CloudAbstractFactory <|.. AzureCloudFactory
  CloudAbstractFactory <|.. GCPCloudFactory
  CloudAbstractFactory <|.. OracleCloudFactory
  CloudAbstractFactory <|.. OnPremiseCloudFactory
}

package "Productos Concretos (VM)" {
  abstract class VirtualMachine
  class EC2Instance
  class AzureVirtualMachine
  class ComputeEngineInstance
  class OracleComputeInstance
  class OnPremiseVirtualMachine

  VirtualMachine <|-- EC2Instance
  VirtualMachine <|-- AzureVirtualMachine
  VirtualMachine <|-- ComputeEngineInstance
  VirtualMachine <|-- OracleComputeInstance
  VirtualMachine <|-- OnPremiseVirtualMachine
}

class VMService {
  +build_vm(data): VMDTO
}

VMService --> VMTierDirector : construye config
VMService --> CloudAbstractFactory : crea VM
AWSCloudFactory --> EC2Instance
AzureCloudFactory --> AzureVirtualMachine
GCPCloudFactory --> ComputeEngineInstance
OracleCloudFactory --> OracleComputeInstance
OnPremiseCloudFactory --> OnPremiseVirtualMachine

note right of VMTierDirector
  - Añade anotaciones didácticas: vcpus, memory_gb
  - Propaga opcionales: key_pair_name, firewall_rules, public_ip,
    memory_optimization, disk_optimization, storage_iops
  - profile (general|memory|compute) hoy es didáctico;
    el mapping por familia real puede ampliarse en los builders
end note

@enduml
